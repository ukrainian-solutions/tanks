$(function() {
  var create_map, draw_tank, move_tank, my_direction, my_go, my_tank, start, start_game, stop;
  start = false;
  stop = true;
  my_direction = 'up';
  my_go = false;
  my_tank = false;
  create_map = function(map) {
    var div, x, y, _i, _j, _ref, _ref1, _results;
    div = $('<div/>', {
      id: 'box',
      text: 'I am box'
    });
    _results = [];
    for (x = _i = 0, _ref = map.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; x = 0 <= _ref ? ++_i : --_i) {
      for (y = _j = 0, _ref1 = map[x].length; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
        if (map[x][y] === 0) {
          $('<div/>', {
            id: 'box',
            'class': 'box',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
          continue;
        }
        if (map[x][y] === 1) {
          $('<div/>', {
            id: 'box',
            'class': 'box wall',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
          continue;
        }
        if (map[x][y] === 3) {
          $('<div/>', {
            id: 'box',
            'class': 'box grass',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
        }
        if (map[x][y] === 4) {
          $('<div/>', {
            id: 'box',
            'class': 'box water',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
        }
      }
      _results.push($('<div/>', {
        id: 'nbox',
        'style': 'clear: both;'
      }).appendTo('body'));
    }
    return _results;
  };
  start_game = function() {
    return socket.emit('addTank', function(tank_json) {
      if (tank_json["id"] === void 0) {
        my_tank = new Tank(tank_json);
        tank_json = {
          "id": tank_json[0],
          "direction": tank_json[1],
          "is_hold": tank_json[2],
          "wait": tank_json[3],
          "bullets": tank_json[4],
          "bullets_max": tank_json[5],
          "health": tank_json[6],
          "place_on_map": tank_json[7]
        };
      }
      console.log('this is tank', tank_json);
      return draw_tank(tank_json);
    });
  };
  start_game();
  draw_tank = function(tank_json) {
    var div, x, y;
    if (tank_json["id"] === void 0) {
      tank_json = {
        "id": tank_json[0],
        "direction": tank_json[1],
        "is_hold": tank_json[2],
        "wait": tank_json[3],
        "bullets": tank_json[4],
        "bullets_max": tank_json[5],
        "health": tank_json[6],
        "place_on_map": tank_json[7]
      };
    }
    y = tank_json['place_on_map'][0];
    x = tank_json['place_on_map'][1];
    div = $('*[data-x=' + x.toString() + '][data-y=' + y.toString() + ']');
    div.attr('data-id_tank', tank_json['id']);
    div.html(tank_json['health']);
    if (tank_json['id'] === my_tank.id) {
      div.addClass('my_tank');
    } else {
      div.addClass('tank');
    }
    return div.addClass(tank_json['direction']);
  };
  move_tank = function(tank_json) {
    var tank;
    if (tank_json["id"] === void 0) {
      tank_json = {
        "id": tank_json[0],
        "direction": tank_json[1],
        "is_hold": tank_json[2],
        "wait": tank_json[3],
        "bullets": tank_json[4],
        "bullets_max": tank_json[5],
        "health": tank_json[6],
        "place_on_map": tank_json[7]
      };
    }
    tank = $('[data-id_tank=' + tank_json['id'] + ']');
    tank.html('');
    if (tank_json['id'] === my_tank.id) {
      tank.removeClass('my_tank');
    } else {
      tank.removeClass('tank');
    }
    tank.removeClass('left');
    tank.removeClass('right');
    tank.removeClass('down');
    tank.removeClass('up');
    tank.addClass('box');
    return draw_tank(tank_json);
  };
  $('html').keydown(function(eventObject) {
    var go, now_direct;
    now_direct = my_direction;
    go = my_go;
    if (event.keyCode === 37) {
      console.log("Ура нажали left");
      now_direct = 'left';
    }
    if (event.keyCode === 38) {
      console.log("Ура нажали up");
      now_direct = 'up';
    }
    if (event.keyCode === 39) {
      console.log("Ура нажали right");
      now_direct = 'right';
    }
    if (event.keyCode === 40) {
      console.log("Ура нажали down");
      now_direct = 'down';
    }
    if (event.keyCode === 81) {
      console.log('Ура нажали го');
      go = false;
    }
    if (event.keyCode === 87) {
      console.log('Ура нажали stop');
      go = true;
    }
    if (my_direction !== now_direct) {
      socket.emit('setDirection', now_direct, my_go);
      my_direction = now_direct;
      my_go = go;
    }
    if (my_go !== go) {
      my_go = go;
      return socket.emit('setDirection', my_direction, my_go);
    }
  });
  socket.on('tanks', function(tanks) {
    var tank, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = tanks.length; _i < _len; _i++) {
      tank = tanks[_i];
      _results.push(move_tank(tank));
    }
    return _results;
  });
  socket.on('info', function(logg) {
    return console.log(logg);
  });
  socket.emit('map', function(map) {
    return create_map(map);
  });
  socket.emit('tanks', function(tanks_json) {
    var tank, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = tanks_json.length; _i < _len; _i++) {
      tank = tanks_json[_i];
      _results.push(draw_tank(tank));
    }
    return _results;
  });
  $('#start').bind('click', function() {
    if (!start) {
      console.log('start');
      socket.emit('start');
      return stop = false;
    }
  });
  return $('#stop').bind('click', function() {
    if (!stop) {
      console.log('stop');
      socket.emit('stop');
      return start = false;
    }
  });
});

//# sourceMappingURL=data:application/json;base64,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QUEsTUFDQSxNQUFNLENBQUMsSUFBUCxDQUFZLE9BQVosQ0FEQSxDQUFBO2FBRUEsSUFBQSxHQUFPLE1BSFQ7S0FEd0I7RUFBQSxDQUExQixDQXhMQSxDQUFBO1NBK0xBLENBQUEsQ0FBRSxPQUFGLENBQVUsQ0FBQyxJQUFYLENBQWdCLE9BQWhCLEVBQXlCLFNBQUEsR0FBQTtBQUN2QixJQUFBLElBQUcsQ0FBQSxJQUFIO0FBQ0UsTUFBQSxPQUFPLENBQUMsR0FBUixDQUFZLE1BQVosQ0FBQSxDQUFBO0FBQUEsTUFDQSxNQUFNLENBQUMsSUFBUCxDQUFZLE1BQVosQ0FEQSxDQUFBO2FBRUEsS0FBQSxHQUFRLE1BSFY7S0FEdUI7RUFBQSxDQUF6QixFQWhNQTtBQUFBLENBQUYsQ0FBQSxDQUFBIiwiZmlsZSI6ImpzL21hcF9jcmVhdGUuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyIkIC0+XG4gIHN0YXJ0ID0gZmFsc2VcbiAgc3RvcCA9IHRydWVcbiAgbXlfZGlyZWN0aW9uID0gJ3VwJ1xuICBteV9nbyA9IGZhbHNlXG4gIG15X3RhbmsgPSBmYWxzZVxuICBjcmVhdGVfbWFwID0gKG1hcCkgLT5cbiAgICBkaXYgPSAkKCc8ZGl2Lz4nLCB7XG4gICAgaWQ6ICdib3gnLFxuICAgIHRleHQ6ICdJIGFtIGJveCdcbiAgICB9KVxuICAgIGZvciB4IGluIFswLi5tYXAubGVuZ3RoLTFdXG4gICAgICBmb3IgeSBpbiBbMC4ubWFwW3hdLmxlbmd0aF1cbiAgICAgICAgaWYgbWFwW3hdW3ldID09IDBcbiAgICAgICAgICAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgICBpZDogJ2JveCcsXG4gICAgICAgICAgICAnY2xhc3MnOiAnYm94JyxcbiAgICAgICAgICAgICdkYXRhLXgnOiB4LFxuICAgICAgICAgICAgJ2RhdGEteSc6IHlcbiAgICAgICAgICB9KS5hcHBlbmRUbyAnYm9keSdcbiAgICAgICAgICBjb250aW51ZVxuICAgICAgICBpZihtYXBbeF1beV0gPT0gMSlcbiAgICAgICAgICAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICdjbGFzcyc6ICdib3ggd2FsbCcsXG4gICAgICAgICAgJ2RhdGEteCc6IHgsXG4gICAgICAgICAgJ2RhdGEteSc6IHlcbiAgICAgICAgICB9KS5hcHBlbmRUbygnYm9keScpXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgaWYobWFwW3hdW3ldID09IDMpXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCBncmFzcycsXG4gICAgICAgICAgICAnZGF0YS14JzogeCxcbiAgICAgICAgICAgICdkYXRhLXknOiB5XG4gICAgICAgICAgfSkuYXBwZW5kVG8gJ2JvZHknXG5cbiAgICAgICAgaWYobWFwW3hdW3ldID09IDQpXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCB3YXRlcicsXG4gICAgICAgICAgICAnZGF0YS14JzogeCxcbiAgICAgICAgICAgICdkYXRhLXknOiB5XG4gICAgICAgICAgfSkuYXBwZW5kVG8gJ2JvZHknXG4gICAgICAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgIGlkOiAnbmJveCcsXG4gICAgICAgICdzdHlsZSc6ICdjbGVhcjogYm90aDsnXG4gICAgICB9KS5hcHBlbmRUbyAnYm9keSdcblxuICBzdGFydF9nYW1lID0gICgpLT5cbiAgICBzb2NrZXQuZW1pdCgnYWRkVGFuaycsICh0YW5rX2pzb24pIC0+XG4gICAgICBpZiB0YW5rX2pzb25bXCJpZFwiXSA9PSB1bmRlZmluZWRcbiAgICAgICAgbXlfdGFuayA9IG5ldyBUYW5rKHRhbmtfanNvbilcbiAgICAgICAgdGFua19qc29uID1cbiAgICAgICAgICBcImlkXCI6IHRhbmtfanNvblswXSxcbiAgICAgICAgICBcImRpcmVjdGlvblwiOiB0YW5rX2pzb25bMV0sXG4gICAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgICBcIndhaXRcIjogdGFua19qc29uWzNdLFxuICAgICAgICAgIFwiYnVsbGV0c1wiOiB0YW5rX2pzb25bNF0sXG4gICAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgICAgXCJoZWFsdGhcIjogdGFua19qc29uWzZdLFxuICAgICAgICAgIFwicGxhY2Vfb25fbWFwXCI6IHRhbmtfanNvbls3XVxuXG4gICAgICBjb25zb2xlLmxvZygndGhpcyBpcyB0YW5rJywgdGFua19qc29uKTtcbiAgICAgIGRyYXdfdGFuayh0YW5rX2pzb24pXG4gICAgICApXG5cbiAgc3RhcnRfZ2FtZSgpXG5cbiAgZHJhd190YW5rID0gKHRhbmtfanNvbikgLT5cbiAgICAjIHJldHVybiBbQGlkLCBAZGlyZWN0aW9uLCBAaXNfaG9sZCwgQHdhaXQsIEBidWxsZXRzLCBAYnVsbGV0c19tYXgsIEBoZWFsdGgsIEBwbGFjZV9vbl9tYXBdXG4gICAgaWYodGFua19qc29uW1wiaWRcIl0gPT0gdW5kZWZpbmVkKVxuICAgICAgdGFua19qc29uID1cbiAgICAgICAgXCJpZFwiOiB0YW5rX2pzb25bMF0sXG4gICAgICAgIFwiZGlyZWN0aW9uXCI6IHRhbmtfanNvblsxXSxcbiAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgXCJ3YWl0XCI6IHRhbmtfanNvblszXSxcbiAgICAgICAgXCJidWxsZXRzXCI6IHRhbmtfanNvbls0XSxcbiAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgIFwiaGVhbHRoXCI6IHRhbmtfanNvbls2XSxcbiAgICAgICAgXCJwbGFjZV9vbl9tYXBcIjogdGFua19qc29uWzddXG5cbiAgICB5ID0gdGFua19qc29uWydwbGFjZV9vbl9tYXAnXVswXVxuICAgIHggPSB0YW5rX2pzb25bJ3BsYWNlX29uX21hcCddWzFdXG4gICAgZGl2ID0gJCgnKltkYXRhLXg9Jyt4LnRvU3RyaW5nKCkrJ11bZGF0YS15PScrIHkudG9TdHJpbmcoKSsnXScpXG4gICAgZGl2LmF0dHIoJ2RhdGEtaWRfdGFuaycsIHRhbmtfanNvblsnaWQnXSlcbiAgICBkaXYuaHRtbCh0YW5rX2pzb25bJ2hlYWx0aCddKVxuICAgIGlmKHRhbmtfanNvblsnaWQnXSA9PSBteV90YW5rLmlkKVxuICAgICAgICBkaXYuYWRkQ2xhc3MoJ215X3RhbmsnKVxuICAgIGVsc2VcbiAgICAgICAgZGl2LmFkZENsYXNzKCd0YW5rJylcbiAgICBkaXYuYWRkQ2xhc3ModGFua19qc29uWydkaXJlY3Rpb24nXSlcblxuICBtb3ZlX3RhbmsgPSAodGFua19qc29uKSAtPlxuICAgICMvLyB0b0pzb246IC0+IFtAaWRcbiAgICAjICAgICAgICAgICAgLy8gQGRpcmVjdGlvblxuICAgICMgICAgICAgICAgICAvLyBAaXNfaG9sZFxuICAgICMgICAgICAgICAgICAvLyBAd2FpdFxuICAgICMgICAgICAgICAgICAvLyBAYnVsbGV0c1xuICAgICMgICAgICAgICAgICAvLyBAYnVsbGV0c19tYXhcbiAgICAjICAgICAgICAgICAgLy8gQGhlYWx0aFxuICAgICMgICAgICAgICAgICAvLyBAcGxhY2Vfb25fbWFwXG4gICAgIyAgICAgICAgICAgLy8gQGRhbWFnZV9pbmZsaWN0ZWRcbiAgICAjICAgICAgICAgICAgIC8vIEBkZW1hZ2Vfb2J0YWluZWRcbiAgICAjICAgICAgICAgICAgIC8vIEBkZXN0cm95ZWRdXG4gICAgaWYodGFua19qc29uW1wiaWRcIl0gPT0gdW5kZWZpbmVkKVxuICAgICAgdGFua19qc29uID1cbiAgICAgICAgXCJpZFwiOiB0YW5rX2pzb25bMF0sXG4gICAgICAgIFwiZGlyZWN0aW9uXCI6IHRhbmtfanNvblsxXSxcbiAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgXCJ3YWl0XCI6IHRhbmtfanNvblszXSxcbiAgICAgICAgXCJidWxsZXRzXCI6IHRhbmtfanNvbls0XSxcbiAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgIFwiaGVhbHRoXCI6IHRhbmtfanNvbls2XSxcbiAgICAgICAgXCJwbGFjZV9vbl9tYXBcIjogdGFua19qc29uWzddXG5cbiAgICB0YW5rID0gJCgnW2RhdGEtaWRfdGFuaz0nK3RhbmtfanNvblsnaWQnXSsnXScpXG4gICAgdGFuay5odG1sKCcnKVxuICAgIGlmIHRhbmtfanNvblsnaWQnXSA9PSBteV90YW5rLmlkXG4gICAgICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ215X3RhbmsnKVxuICAgIGVsc2VcbiAgICAgICAgdGFuay5yZW1vdmVDbGFzcygndGFuaycpXG4gICAgdGFuay5yZW1vdmVDbGFzcygnbGVmdCcpXG4gICAgdGFuay5yZW1vdmVDbGFzcygncmlnaHQnKVxuICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ2Rvd24nKVxuICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ3VwJylcbiAgICB0YW5rLmFkZENsYXNzKCdib3gnKVxuICAgIGRyYXdfdGFuayh0YW5rX2pzb24pXG5cbiAgJCgnaHRtbCcpLmtleWRvd24oIChldmVudE9iamVjdCkgLT5cbiAgICBub3dfZGlyZWN0ID0gbXlfZGlyZWN0aW9uXG4gICAgZ28gPSBteV9nb1xuICAgIGlmIChldmVudC5rZXlDb2RlID09IDM3KVxuICAgICAgICBjb25zb2xlLmxvZyhcItCj0YDQsCDQvdCw0LbQsNC70LggbGVmdFwiKVxuICAgICAgICBub3dfZGlyZWN0ID0gJ2xlZnQnXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAzOClcbiAgICAgICAgY29uc29sZS5sb2coXCLQo9GA0LAg0L3QsNC20LDQu9C4IHVwXCIpXG4gICAgICAgIG5vd19kaXJlY3QgPSAndXAnXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAzOSlcbiAgICAgICAgY29uc29sZS5sb2coXCLQo9GA0LAg0L3QsNC20LDQu9C4IHJpZ2h0XCIpO1xuICAgICAgICBub3dfZGlyZWN0ID0gJ3JpZ2h0J1xuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDApXG4gICAgICAgIGNvbnNvbGUubG9nKFwi0KPRgNCwINC90LDQttCw0LvQuCBkb3duXCIpO1xuICAgICAgICBub3dfZGlyZWN0ID0gJ2Rvd24nXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSA4MSlcbiAgICAgICAgY29uc29sZS5sb2coJ9Cj0YDQsCDQvdCw0LbQsNC70Lgg0LPQvicpO1xuICAgICAgICBnbyA9IGZhbHNlO1xuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gODcpXG4gICAgICAgIGNvbnNvbGUubG9nKCfQo9GA0LAg0L3QsNC20LDQu9C4IHN0b3AnKVxuICAgICAgICBnbyA9IHRydWVcblxuICAgIGlmIG15X2RpcmVjdGlvbiAhPSBub3dfZGlyZWN0XG4gICAgICBzb2NrZXQuZW1pdCgnc2V0RGlyZWN0aW9uJywgbm93X2RpcmVjdCwgbXlfZ28pXG4gICAgICBteV9kaXJlY3Rpb24gPSBub3dfZGlyZWN0XG4gICAgICBteV9nbyA9IGdvXG4gICAgaWYgbXlfZ28gIT0gZ29cbiAgICAgIG15X2dvID0gZ29cbiAgICAgIHNvY2tldC5lbWl0KCdzZXREaXJlY3Rpb24nLCBteV9kaXJlY3Rpb24sIG15X2dvKVxuICAgIClcblxuICBzb2NrZXQub24oJ3RhbmtzJywgKHRhbmtzKSAtPlxuICAjICAgLy8gY29uc29sZS5sb2codGFua3NbMV0ucGxhY2Vfb25fbWFwKTtcbiAgICBmb3IgdGFuayBpbiB0YW5rc1xuICAgICAgbW92ZV90YW5rKHRhbmspXG4gIClcblxuICBzb2NrZXQub24oJ2luZm8nLCAobG9nZykgLT5cbiAgICBjb25zb2xlLmxvZyhsb2dnKVxuICApXG5cbiAgc29ja2V0LmVtaXQoJ21hcCcsIChtYXApIC0+XG4gICAgY3JlYXRlX21hcChtYXApXG4gIClcblxuICBzb2NrZXQuZW1pdCgndGFua3MnLCAodGFua3NfanNvbikgLT5cbiAgICBmb3IgdGFuayBpbiB0YW5rc19qc29uXG4gICAgICAgICAgZHJhd190YW5rKHRhbmspXG4gIClcblxuXG4gICQoJyNzdGFydCcpLmJpbmQoJ2NsaWNrJywgKCkgLT5cbiAgICBpZiBub3Qgc3RhcnRcbiAgICAgIGNvbnNvbGUubG9nKCdzdGFydCcpXG4gICAgICBzb2NrZXQuZW1pdCgnc3RhcnQnKVxuICAgICAgc3RvcCA9IGZhbHNlXG4gIClcblxuICAkKCcjc3RvcCcpLmJpbmQoJ2NsaWNrJywgKCkgLT5cbiAgICBpZiBub3Qgc3RvcFxuICAgICAgY29uc29sZS5sb2coJ3N0b3AnKVxuICAgICAgc29ja2V0LmVtaXQoJ3N0b3AnKVxuICAgICAgc3RhcnQgPSBmYWxzZVxuICApXG4iXX0=