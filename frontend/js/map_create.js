$(function() {
  var callback, create_map, draw_tank, lock, move_tank, my_direction, my_go, my_tank, start, start_game, stop;
  start = false;
  stop = true;
  my_direction = 'up';
  my_go = false;
  my_tank = false;
  lock = false;
  callback = function() {
    return lock = false;
  };
  setTimeout(callback, 3000);
  create_map = function(map) {
    var div, x, y, _i, _j, _ref, _ref1, _results;
    div = $('<div/>', {
      id: 'box',
      text: 'I am box'
    });
    _results = [];
    for (x = _i = 0, _ref = map.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; x = 0 <= _ref ? ++_i : --_i) {
      for (y = _j = 0, _ref1 = map[x].length; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; y = 0 <= _ref1 ? ++_j : --_j) {
        if (map[x][y] === 0) {
          $('<div/>', {
            id: 'box',
            'class': 'box',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
          continue;
        }
        if (map[x][y] === 1) {
          $('<div/>', {
            id: 'box',
            'class': 'box wall',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
          continue;
        }
        if (map[x][y] === 3) {
          $('<div/>', {
            id: 'box',
            'class': 'box grass',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
        }
        if (map[x][y] === 4) {
          $('<div/>', {
            id: 'box',
            'class': 'box water',
            'data-x': x,
            'data-y': y
          }).appendTo('body');
        }
      }
      _results.push($('<div/>', {
        id: 'nbox',
        'style': 'clear: both;'
      }).appendTo('body'));
    }
    return _results;
  };
  start_game = function() {
    return socket.emit('addTank', function(tank_json) {
      if (tank_json["id"] === void 0) {
        my_tank = new Tank(tank_json);
        tank_json = {
          "id": tank_json[0],
          "direction": tank_json[1],
          "is_hold": tank_json[2],
          "wait": tank_json[3],
          "bullets": tank_json[4],
          "bullets_max": tank_json[5],
          "health": tank_json[6],
          "place_on_map": tank_json[7]
        };
      }
      console.log('this is tank', tank_json);
      return draw_tank(tank_json);
    });
  };
  start_game();
  draw_tank = function(tank_json) {
    var div, x, y;
    if (tank_json["id"] === void 0) {
      tank_json = {
        "id": tank_json[0],
        "direction": tank_json[1],
        "is_hold": tank_json[2],
        "wait": tank_json[3],
        "bullets": tank_json[4],
        "bullets_max": tank_json[5],
        "health": tank_json[6],
        "place_on_map": tank_json[7]
      };
    }
    y = tank_json['place_on_map'][0];
    x = tank_json['place_on_map'][1];
    div = $('*[data-x=' + x.toString() + '][data-y=' + y.toString() + ']');
    div.attr('data-id_tank', tank_json['id']);
    div.html(tank_json['health']);
    if (tank_json['id'] === my_tank.id) {
      div.addClass('my_tank');
    } else {
      div.addClass('tank');
    }
    return div.addClass(tank_json['direction']);
  };
  move_tank = function(tank_json) {
    var tank;
    if (tank_json["id"] === void 0) {
      tank_json = {
        "id": tank_json[0],
        "direction": tank_json[1],
        "is_hold": tank_json[2],
        "wait": tank_json[3],
        "bullets": tank_json[4],
        "bullets_max": tank_json[5],
        "health": tank_json[6],
        "place_on_map": tank_json[7]
      };
    }
    tank = $('[data-id_tank=' + tank_json['id'] + ']');
    tank.html('');
    if (tank_json['id'] === my_tank.id) {
      tank.removeClass('my_tank');
    } else {
      tank.removeClass('tank');
    }
    tank.removeClass('left');
    tank.removeClass('right');
    tank.removeClass('down');
    tank.removeClass('up');
    tank.addClass('box');
    return draw_tank(tank_json);
  };
  $('html').keydown(function(eventObject) {
    var go, now_direct;
    now_direct = my_direction;
    go = my_go;
    if (event.keyCode === 37) {
      console.log("Ура нажали left");
      now_direct = 'left';
    }
    if (event.keyCode === 38) {
      console.log("Ура нажали up");
      now_direct = 'up';
    }
    if (event.keyCode === 39) {
      console.log("Ура нажали right");
      now_direct = 'right';
    }
    if (event.keyCode === 40) {
      console.log("Ура нажали down");
      now_direct = 'down';
    }
    if (event.keyCode === 81) {
      console.log('Ура нажали го');
      go = false;
    }
    if (event.keyCode === 87) {
      console.log('Ура нажали stop');
      go = true;
    }
    return socket.emit('setDirection', now_direct, go);
  });
  socket.on('tanks', function(tanks) {
    var tank, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = tanks.length; _i < _len; _i++) {
      tank = tanks[_i];
      _results.push(move_tank(tank));
    }
    return _results;
  });
  socket.on('info', function(logg) {
    return console.log(logg);
  });
  socket.emit('map', function(map) {
    return create_map(map);
  });
  socket.emit('tanks', function(tanks_json) {
    var tank, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = tanks_json.length; _i < _len; _i++) {
      tank = tanks_json[_i];
      _results.push(draw_tank(tank));
    }
    return _results;
  });
  $('#start').bind('click', function() {
    if (!start) {
      console.log('start');
      socket.emit('start');
      return stop = false;
    }
  });
  return $('#stop').bind('click', function() {
    if (!stop) {
      console.log('stop');
      socket.emit('stop');
      return start = false;
    }
  });
});

//# sourceMappingURL=data:application/json;base64,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U0E2TEEsQ0FBQSxDQUFFLE9BQUYsQ0FBVSxDQUFDLElBQVgsQ0FBZ0IsT0FBaEIsRUFBeUIsU0FBQSxHQUFBO0FBQ3ZCLElBQUEsSUFBRyxDQUFBLElBQUg7QUFDRSxNQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksTUFBWixDQUFBLENBQUE7QUFBQSxNQUNBLE1BQU0sQ0FBQyxJQUFQLENBQVksTUFBWixDQURBLENBQUE7YUFFQSxLQUFBLEdBQVEsTUFIVjtLQUR1QjtFQUFBLENBQXpCLEVBOUxBO0FBQUEsQ0FBRixDQUFBLENBQUEiLCJmaWxlIjoianMvbWFwX2NyZWF0ZS5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIiQgLT5cbiAgc3RhcnQgPSBmYWxzZVxuICBzdG9wID0gdHJ1ZVxuICBteV9kaXJlY3Rpb24gPSAndXAnXG4gIG15X2dvID0gZmFsc2VcbiAgbXlfdGFuayA9IGZhbHNlXG4gIGxvY2sgPSBmYWxzZVxuICBjYWxsYmFjayA9IC0+XG4gICAgbG9jayA9IGZhbHNlXG4gIHNldFRpbWVvdXQgY2FsbGJhY2ssIDMwMDBcbiAgY3JlYXRlX21hcCA9IChtYXApIC0+XG4gICAgZGl2ID0gJCgnPGRpdi8+Jywge1xuICAgIGlkOiAnYm94JyxcbiAgICB0ZXh0OiAnSSBhbSBib3gnXG4gICAgfSlcbiAgICBmb3IgeCBpbiBbMC4ubWFwLmxlbmd0aC0xXVxuICAgICAgZm9yIHkgaW4gWzAuLm1hcFt4XS5sZW5ndGhdXG4gICAgICAgIGlmIG1hcFt4XVt5XSA9PSAwXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCcsXG4gICAgICAgICAgICAnZGF0YS14JzogeCxcbiAgICAgICAgICAgICdkYXRhLXknOiB5XG4gICAgICAgICAgfSkuYXBwZW5kVG8gJ2JvZHknXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgaWYobWFwW3hdW3ldID09IDEpXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCB3YWxsJyxcbiAgICAgICAgICAgICdkYXRhLXgnOiB4LFxuICAgICAgICAgICAgJ2RhdGEteSc6IHlcbiAgICAgICAgICB9KS5hcHBlbmRUbygnYm9keScpXG4gICAgICAgICAgY29udGludWVcbiAgICAgICAgaWYobWFwW3hdW3ldID09IDMpXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCBncmFzcycsXG4gICAgICAgICAgICAnZGF0YS14JzogeCxcbiAgICAgICAgICAgICdkYXRhLXknOiB5XG4gICAgICAgICAgfSkuYXBwZW5kVG8gJ2JvZHknXG5cbiAgICAgICAgaWYobWFwW3hdW3ldID09IDQpXG4gICAgICAgICAgJCgnPGRpdi8+Jywge1xuICAgICAgICAgICAgaWQ6ICdib3gnLFxuICAgICAgICAgICAgJ2NsYXNzJzogJ2JveCB3YXRlcicsXG4gICAgICAgICAgICAnZGF0YS14JzogeCxcbiAgICAgICAgICAgICdkYXRhLXknOiB5XG4gICAgICAgICAgfSkuYXBwZW5kVG8gJ2JvZHknXG4gICAgICAkKCc8ZGl2Lz4nLCB7XG4gICAgICAgIGlkOiAnbmJveCcsXG4gICAgICAgICdzdHlsZSc6ICdjbGVhcjogYm90aDsnXG4gICAgICB9KS5hcHBlbmRUbyAnYm9keSdcblxuICBzdGFydF9nYW1lID0gICgpLT5cbiAgICBzb2NrZXQuZW1pdCgnYWRkVGFuaycsICh0YW5rX2pzb24pIC0+XG4gICAgICBpZiB0YW5rX2pzb25bXCJpZFwiXSA9PSB1bmRlZmluZWRcbiAgICAgICAgbXlfdGFuayA9IG5ldyBUYW5rKHRhbmtfanNvbilcbiAgICAgICAgdGFua19qc29uID1cbiAgICAgICAgICBcImlkXCI6IHRhbmtfanNvblswXSxcbiAgICAgICAgICBcImRpcmVjdGlvblwiOiB0YW5rX2pzb25bMV0sXG4gICAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgICBcIndhaXRcIjogdGFua19qc29uWzNdLFxuICAgICAgICAgIFwiYnVsbGV0c1wiOiB0YW5rX2pzb25bNF0sXG4gICAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgICAgXCJoZWFsdGhcIjogdGFua19qc29uWzZdLFxuICAgICAgICAgIFwicGxhY2Vfb25fbWFwXCI6IHRhbmtfanNvbls3XVxuXG4gICAgICBjb25zb2xlLmxvZygndGhpcyBpcyB0YW5rJywgdGFua19qc29uKTtcbiAgICAgIGRyYXdfdGFuayh0YW5rX2pzb24pXG4gICAgICApXG5cbiAgc3RhcnRfZ2FtZSgpXG5cbiAgZHJhd190YW5rID0gKHRhbmtfanNvbikgLT5cbiAgICAjIHJldHVybiBbQGlkLCBAZGlyZWN0aW9uLCBAaXNfaG9sZCwgQHdhaXQsIEBidWxsZXRzLCBAYnVsbGV0c19tYXgsIEBoZWFsdGgsIEBwbGFjZV9vbl9tYXBdXG4gICAgaWYodGFua19qc29uW1wiaWRcIl0gPT0gdW5kZWZpbmVkKVxuICAgICAgdGFua19qc29uID1cbiAgICAgICAgXCJpZFwiOiB0YW5rX2pzb25bMF0sXG4gICAgICAgIFwiZGlyZWN0aW9uXCI6IHRhbmtfanNvblsxXSxcbiAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgXCJ3YWl0XCI6IHRhbmtfanNvblszXSxcbiAgICAgICAgXCJidWxsZXRzXCI6IHRhbmtfanNvbls0XSxcbiAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgIFwiaGVhbHRoXCI6IHRhbmtfanNvbls2XSxcbiAgICAgICAgXCJwbGFjZV9vbl9tYXBcIjogdGFua19qc29uWzddXG5cbiAgICB5ID0gdGFua19qc29uWydwbGFjZV9vbl9tYXAnXVswXVxuICAgIHggPSB0YW5rX2pzb25bJ3BsYWNlX29uX21hcCddWzFdXG4gICAgZGl2ID0gJCgnKltkYXRhLXg9Jyt4LnRvU3RyaW5nKCkrJ11bZGF0YS15PScrIHkudG9TdHJpbmcoKSsnXScpXG4gICAgZGl2LmF0dHIoJ2RhdGEtaWRfdGFuaycsIHRhbmtfanNvblsnaWQnXSlcbiAgICBkaXYuaHRtbCh0YW5rX2pzb25bJ2hlYWx0aCddKVxuICAgIGlmKHRhbmtfanNvblsnaWQnXSA9PSBteV90YW5rLmlkKVxuICAgICAgICBkaXYuYWRkQ2xhc3MoJ215X3RhbmsnKVxuICAgIGVsc2VcbiAgICAgICAgZGl2LmFkZENsYXNzKCd0YW5rJylcbiAgICBkaXYuYWRkQ2xhc3ModGFua19qc29uWydkaXJlY3Rpb24nXSlcblxuICBtb3ZlX3RhbmsgPSAodGFua19qc29uKSAtPlxuICAgICMvLyB0b0pzb246IC0+IFtAaWRcbiAgICAjICAgICAgICAgICAgLy8gQGRpcmVjdGlvblxuICAgICMgICAgICAgICAgICAvLyBAaXNfaG9sZFxuICAgICMgICAgICAgICAgICAvLyBAd2FpdFxuICAgICMgICAgICAgICAgICAvLyBAYnVsbGV0c1xuICAgICMgICAgICAgICAgICAvLyBAYnVsbGV0c19tYXhcbiAgICAjICAgICAgICAgICAgLy8gQGhlYWx0aFxuICAgICMgICAgICAgICAgICAvLyBAcGxhY2Vfb25fbWFwXG4gICAgIyAgICAgICAgICAgLy8gQGRhbWFnZV9pbmZsaWN0ZWRcbiAgICAjICAgICAgICAgICAgIC8vIEBkZW1hZ2Vfb2J0YWluZWRcbiAgICAjICAgICAgICAgICAgIC8vIEBkZXN0cm95ZWRdXG4gICAgaWYodGFua19qc29uW1wiaWRcIl0gPT0gdW5kZWZpbmVkKVxuICAgICAgdGFua19qc29uID1cbiAgICAgICAgXCJpZFwiOiB0YW5rX2pzb25bMF0sXG4gICAgICAgIFwiZGlyZWN0aW9uXCI6IHRhbmtfanNvblsxXSxcbiAgICAgICAgXCJpc19ob2xkXCI6IHRhbmtfanNvblsyXSxcbiAgICAgICAgXCJ3YWl0XCI6IHRhbmtfanNvblszXSxcbiAgICAgICAgXCJidWxsZXRzXCI6IHRhbmtfanNvbls0XSxcbiAgICAgICAgXCJidWxsZXRzX21heFwiOiB0YW5rX2pzb25bNV0sXG4gICAgICAgIFwiaGVhbHRoXCI6IHRhbmtfanNvbls2XSxcbiAgICAgICAgXCJwbGFjZV9vbl9tYXBcIjogdGFua19qc29uWzddXG5cbiAgICB0YW5rID0gJCgnW2RhdGEtaWRfdGFuaz0nK3RhbmtfanNvblsnaWQnXSsnXScpXG4gICAgdGFuay5odG1sKCcnKVxuICAgIGlmIHRhbmtfanNvblsnaWQnXSA9PSBteV90YW5rLmlkXG4gICAgICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ215X3RhbmsnKVxuICAgIGVsc2VcbiAgICAgICAgdGFuay5yZW1vdmVDbGFzcygndGFuaycpXG4gICAgdGFuay5yZW1vdmVDbGFzcygnbGVmdCcpXG4gICAgdGFuay5yZW1vdmVDbGFzcygncmlnaHQnKVxuICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ2Rvd24nKVxuICAgIHRhbmsucmVtb3ZlQ2xhc3MoJ3VwJylcbiAgICB0YW5rLmFkZENsYXNzKCdib3gnKVxuICAgIGRyYXdfdGFuayh0YW5rX2pzb24pXG5cbiAgJCgnaHRtbCcpLmtleWRvd24oIChldmVudE9iamVjdCkgLT5cbiAgICBub3dfZGlyZWN0ID0gbXlfZGlyZWN0aW9uXG4gICAgZ28gPSBteV9nb1xuICAgIGlmIChldmVudC5rZXlDb2RlID09IDM3KVxuICAgICAgICBjb25zb2xlLmxvZyhcItCj0YDQsCDQvdCw0LbQsNC70LggbGVmdFwiKVxuICAgICAgICBub3dfZGlyZWN0ID0gJ2xlZnQnXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAzOClcbiAgICAgICAgY29uc29sZS5sb2coXCLQo9GA0LAg0L3QsNC20LDQu9C4IHVwXCIpXG4gICAgICAgIG5vd19kaXJlY3QgPSAndXAnXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSAzOSlcbiAgICAgICAgY29uc29sZS5sb2coXCLQo9GA0LAg0L3QsNC20LDQu9C4IHJpZ2h0XCIpO1xuICAgICAgICBub3dfZGlyZWN0ID0gJ3JpZ2h0J1xuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gNDApXG4gICAgICAgIGNvbnNvbGUubG9nKFwi0KPRgNCwINC90LDQttCw0LvQuCBkb3duXCIpO1xuICAgICAgICBub3dfZGlyZWN0ID0gJ2Rvd24nXG5cbiAgICBpZiAoZXZlbnQua2V5Q29kZSA9PSA4MSlcbiAgICAgICAgY29uc29sZS5sb2coJ9Cj0YDQsCDQvdCw0LbQsNC70Lgg0LPQvicpO1xuICAgICAgICBnbyA9IGZhbHNlO1xuXG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT0gODcpXG4gICAgICAgIGNvbnNvbGUubG9nKCfQo9GA0LAg0L3QsNC20LDQu9C4IHN0b3AnKVxuICAgICAgICBnbyA9IHRydWVcblxuICAgIHNvY2tldC5lbWl0KCdzZXREaXJlY3Rpb24nLCBub3dfZGlyZWN0LCBnbylcbiAgICApXG5cbiAgc29ja2V0Lm9uKCd0YW5rcycsICh0YW5rcykgLT5cbiAgIyAgIC8vIGNvbnNvbGUubG9nKHRhbmtzWzFdLnBsYWNlX29uX21hcCk7XG4gICAgZm9yIHRhbmsgaW4gdGFua3NcbiAgICAgIG1vdmVfdGFuayh0YW5rKVxuICApXG5cbiAgc29ja2V0Lm9uKCdpbmZvJywgKGxvZ2cpIC0+XG4gICAgY29uc29sZS5sb2cobG9nZylcbiAgKVxuXG4gIHNvY2tldC5lbWl0KCdtYXAnLCAobWFwKSAtPlxuICAgIGNyZWF0ZV9tYXAobWFwKVxuICApXG5cbiAgc29ja2V0LmVtaXQoJ3RhbmtzJywgKHRhbmtzX2pzb24pIC0+XG4gICAgZm9yIHRhbmsgaW4gdGFua3NfanNvblxuICAgICAgICAgIGRyYXdfdGFuayh0YW5rKVxuICApXG5cblxuICAkKCcjc3RhcnQnKS5iaW5kKCdjbGljaycsICgpIC0+XG4gICAgaWYgbm90IHN0YXJ0XG4gICAgICBjb25zb2xlLmxvZygnc3RhcnQnKVxuICAgICAgc29ja2V0LmVtaXQoJ3N0YXJ0JylcbiAgICAgIHN0b3AgPSBmYWxzZVxuICApXG5cbiAgJCgnI3N0b3AnKS5iaW5kKCdjbGljaycsICgpIC0+XG4gICAgaWYgbm90IHN0b3BcbiAgICAgIGNvbnNvbGUubG9nKCdzdG9wJylcbiAgICAgIHNvY2tldC5lbWl0KCdzdG9wJylcbiAgICAgIHN0YXJ0ID0gZmFsc2VcbiAgKVxuIl19